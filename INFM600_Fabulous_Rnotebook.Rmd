---
title: "INFM600_Fabulous_Rnotebook"
output:
  html_document: default
  html_notebook: default
  pdf_document: default
---
#Research Question #1:how do the weather conditions effect bike trips?
```{r}
#read the file
b = read.csv("INFM600_0201_Fabulous_DataSet\\INFM600_0201_Fabulous_DataSet_WeatherRide.csv")

#view the column names
head(b)

#correlation test between temperature and ridership
cor.test(b$mean_temperature, b$rides)

#correlation test between dew point and ridership
cor.test(b$mean_dew, b$rides)

#Multiple Linear Regression
m = lm(rides ~ mean_temperature + mean_dew, data = b)
summary(m)


#test of assumptions

#compute correlations between IVs to check for multicollinearity
cor.test(b$mean_temperature, b$mean_dew)
#the result violates the assumption that there should be no relationship between IVs. 


#plot each IV against the DV to check for non-linearity
plot(b$mean_temperature, b$rides,xlab="Mean Temperature",ylab="The Number of Ridership",main="The Relationship between Mean Temperature and Ridership")
```


Description: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx, xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx


```{r}
plot(b$mean_dew, b$rides,xlab="Mean Dew Point Temperature",ylab="The Number of Ridership",main="The Relationship between Mean Dew Point Temperature and Ridership")
```


Description: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx, xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```{r}
#check for outliers (Residuals vs Fitted)
#there are 3 outliers that are more than 3 standard deviations away
plot(lm(rides ~ mean_temperature + mean_dew, data = b))
```
Description: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx, xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```{r}
#create a histogram of residuals to check for non-normality of error
#residuals are normally distributed, which does not violate the assumption
resid = m$residuals
hist(resid)
```


Description: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx, xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

#Research Question #2: what are the peak hours on bike trips in a day
```{r}
#read the file naming "INFM600_0201_Fabulous_RidershipPerHour.csv"
#the dataset genereate by aggregating data per hour
q = read.csv("INFM600_0201_Fabulous_DataSet\\INFM600_0201_Fabulous_RidershipPerHour.csv")

#show the basic structure of the dataset
head(q)

#basic desscriptive statistics, like mean and SD
mean(q$Ridership)
sd(q$Ridership)

#do a basic plot for the trends of picking up bikes in time of aday
plot(q$Hour,q$Ridership,main="Trends in Hourly Ridership Statistics", xlab="The time of a day",ylab="The Number ofRidership",type="s")
```

Description: 

This graph shows the distribution of picking up bikes in a day. We aggregate the data by hours. From this graph, there are two peak hours of using bikes: 9 am and 5pm, which are typical on duty and off duty time. Therefore, we might conclude that most people use rental bikes to commute to work and go home. This found is contrary to our expectations that tourists are the major group of using rental bikes. 

```{r}

#read the file naming "INFM600_0201_Fabulous_RidershipPerDatePerHour.csv"
#the dataset generated by aggreagating data per date per hour
p = read.csv("INFM600_0201_Fabulous_DataSet\\INFM600_0201_Fabulous_RidershipPerDatePerHour.csv")
attach(p)

#show the basic structure of the dataset
head(p)

#convert the numeric variables to factor/levels
p$Category_ID = factor(p$Category_ID)

#loading the car package
library(car)
#test the homogeneity of variance
leveneTest(p$Ridership~p$Category_ID,p)
#However, after testing the assumption of homogeneity of variance, we found that our dataset violates this assumption

#perform ANOVA
panova=aov(p$Ridership~p$Category_ID,data=p)
summary(panova)

#perform pairwise t-test
pairwise.t.test(p$Ridership,p$Category_ID,p.adj="bonferroni")

```

#Research Question #3: how strongly/feebly the station location play a role in bike trips
```{r}
# read the file
R <- read.csv("INFM600_0201_Fabulous_DataSet\\INFM600_0201_Fabulous_DistanceBetweenStartAndEnd.csv") 
# install the relative package

library(geosphere)
library(data.table)
attach(R)

# calculate the distance between two groups of long and lat and add the distance into the table
# This is the linear distance based on long and lat. We will try to connect Google MAp API and calculate the route distance in the later
setDT(R)[, distance_hav := distHaversine(matrix(c(R$start_long, R$start_lat), ncol = 2), matrix(c(R$end_long, R$end_lat), ncol = 2))]  
# output the table
write.table(R,'distance.txt',quote=FALSE,sep="\t")
#calculate the corrlaton efficient between distance and ridership
cor.test(R$Ridership,R$distance_hav)

#calculate the mean of distance between start station and end station
mean(R$distance_hav)
#calculate the Standard deviation of distance between group of start station and end station
sd(R$distance_hav)
#calcualte the mean of Ridership for groups of start station and end station
mean(R$Ridership)
#calcualte the stanard deviation of ridership for groups of start station and end station
sd(R$distance_hav)

# do a basic histogram and QQ plot of ridership per group of start station and end station
plot(R$distance_hav,R$Ridership,xlab="Distance between Stations",ylab="The Number of Ridership",main="The Relationship between Distance and Ridership",type="h")
```

Description: 

Before this graph, we group all data by start station and end station and use R to calculate the distance between two set of long and lat. The graph shows the relatonship between the number of ridership and the distance between start station and end station. From this graph, it could be identified that there is a negative relatonship between ridership and distance. In other words, the farther the distance between two stations is, the smaller the number of the ridership is. However, there is a limitation that we calculate the linear distance between two set of long and lat, instead of actual distance. (*we have used python to connect Google API and calcualte the actual distance. But Google API will charge us if there are more than 2500 elements, while we have more than 30000 elements)

#Research Question #4:how do the national holidays impact the bike ride counts?
```{r}
#Read the file naming "INFM600_0201_Fabulous_RidershipPerDate_holiday.csv"
h = read.csv("INFM600_0201_Fabulous_DataSet\\INFM600_0201_Fabulous_RidershipPerDate_holiday_edit.csv")
head(h)

#plot all the data
x=plot(h$StartDate,h$Ridership,main="The Ridership Distribution from 2010 to 2016",color="red",xlab="Date",ylab="The Number of Ridership",points(x,cex=1000000000000,col="red"), lwd=1.5)
```

Descrition:

This graph represents the whole distribution of the ridership from 2010 to 2016, which shows a very interesting trend. It is easy to be identified that the ridership is highly related to some key factors, which could be time, weather condition, temperature and season. In addition, in this graph, there are some outliers that have an unsual performance on certain dates. Therefore, we think it might be caused by some other key factors, like holiday or some popular events.


```{r}
#subset records based on whether the date is holiday or not
h.holiday=subset(h,h$DayType=="Holiday")
h.nonholiday=subset(h,h$DayType=="Non_Holiday")

#calculate the mean of Ridership on holiday and non-holiday
mean(h.holiday$Ridership)
mean(h.nonholiday$Ridership)

#calcualte the SD of Ridership on holiday and non-holiday
sd(h.holiday$Ridership)
sd(h.nonholiday$Ridership)

#check the normality of these two data groups
hist(h.holiday$Ridership, main="Histogram of Ridership on Holiday")
```

Description:

The graph shows the distribution of the number of ridership on holiday. As the graph shows, it could be identified that the distribution skewed to the right and is somewhat bimodel distribution, not normal distribution. Therefore, we might cannot use two sample t-test to do further research. 

```{r}
hist(h.nonholiday$Ridership,main="Histogram of Ridership on Non-Holiday")
```

Description:

The graph shows the distribution of the number of ridership on non-holiday. As the graph shows, it could be identified that the distribution is normal distribution, which is different from the above distribution.   

```{r}
qqnorm(h.holiday$Ridership)
qqline(h.holiday$Ridership)
```

Description: 

This graph shows the QQ plot and QQ line for the number of ridership on holiday. However, we conclude a different conclusion compared to the histogram of ridership on holiday. From QQ plot, because of the small samples of data, the distributon is light tailed and normal distribution. 

Reference:
G. (2015, June 10). How to interpret a QQ plot. Retrieved November 29, 2016, from http://stats.stackexchange.com/questions/101274/how-to-interpret-a-qq-plot

```{r}
qqnorm(h.nonholiday$Ridership)
qqline(h.nonholiday$Ridership)
```

Description: 

This graph shows the QQ plot and QQ line for the number of ridership on non-holiday. We conclude a same conclusion with the histogram of ridership on non-holiday. From QQ plot, the distributon is quite normal distribution and light tailed.

Therefore, based on the above test, the distribution of two dataset meet the assumption of two sample t-test.


```{r}
#if the above test for normality is right and the distribution will be normal,we will 
#perform two sample t-test
t.test(h$Ridership~h$DayType,data=h)

#calculate mean, sd, length, df and critical value for both groups
mymeans=tapply(h$Ridership,h$DayType,mean)
mysds=tapply(h$Ridership,h$DayType,sd)
myns=tapply(h$Ridership,h$DayType,length)
dfs=myns-1
tcrits= qt(0.025,dfs,lower.tail = FALSE)
##then you will get a list of tcrits

h.upper = mymeans + tcrits *(mysds/sqrt(myns))
h.lower = mymeans - tcrits *(mysds/sqrt(myns))

H.ci=data.frame(dateType=c("Holiday","Non-Holiday"),Ridership=mymeans,upper=h.upper,lower=h.lower) 
#do a bar plot with error bar:
library(ggplot2)
ggplot(H.ci,aes(x=dateType,y=Ridership,fill=dateType))+geom_bar(stat="identity")+geom_errorbar(aes(ymin=h.lower,ymax=h.upper),width=0.2)+ggtitle("Bar plot for Holiday and Non_Holiday")
```

Description: 

By using ggplot2 to get the box plot, we compared the mean of ridership on holiday and non-holiday with confidence interval. As seen in the graph, it is surprising that the number of ridership on holiday is smaller than the number on non-holiday, contrary to our expectations. In addition, the ridership on holiday has an extremley large confidence interval, which means we might need more data (the number for holiday date: 64 and the number for non-holiday:2047).  